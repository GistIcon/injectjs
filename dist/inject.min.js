/*! inject-js - vv0.3.4 - 2016-03-27
* https://github.com/nstraub/injectjs
* Copyright (c) 2016 ; Licensed  */
"use strict";var injector=function(){function a(){this.types={},this.providers={},this.fakes={},this.state={}}function b(a,b){var c=this,d={};return _.each(b,function(a,b){d[b]=function(){return a}}),_.assign(a,d),_.map(a,function(a,d){if(!a)throw'There is no dependency named "'+d+'" registered.';return a.call(c,b)})}function c(a){if(!~d.indexOf(a))throw'invalid lifetime "'+a+'" provided. Valid lifetimes are singleton, transient, instance and parent'}a.prototype.DEFAULT_LIFETIME="transient",a.prototype.cache={},a.prototype.roots={};var d=["singleton","transient","root","parent","state"],e=window.injector;a.prototype.build_anonymous_descriptor=function(a){return"function"==typeof a?{type:a,dependencies:g(a)}:{type:a.pop(),dependencies:a}},a.prototype._inject=function(a,b,c,d){var e;if(!b){if(c)return null;throw'There is no dependency named "'+a+'" registered.'}if(("singleton"===b.lifetime||"state"===b.lifetime)&&this.cache[b.name]&&this.cache[b.name].hashCode===b.hashCode)return this.cache[b.name];if(c||d||(d=++this.currentHashCode),b.provider&&b.provider!==c)return this._inject(b.provider,this.getDescriptor(b.provider),b.name,d);e={};var f=0;_.each(b.dependencies,_.bind(function(a){var c=this._inject(a,this.getDescriptor(a),b.name,d);e[a]?e[a+f++]=c:e[a]=c},this));var g=this.build_provider(b.name,b,e,d);return g},a.prototype.getDescriptor=function(a){return"string"==typeof a?this.fakes[a]||this.types[a]||this.providers[a]:this.build_anonymous_descriptor(a)},a.prototype.inject=function(a){return this._inject(a,this.getDescriptor(a))},a.prototype.get=function(a,b,c){var d=this.inject(a);return b?d.call(b,c):d(c)},a.prototype.run=function(a,b){if(!this.providers.main)throw"No main method registered. Please register one by running injector.registerMain() before running the app";return this.get("main",a,b)};var f=Object.create;a.prototype.provide_transient=function(a,c){return function(d){var e=f(a.prototype);return a.apply(e,b(c,d)),e}},a.prototype.provide_singleton=function(a,b,c,d){if(!d[a]){var e=this.provide_transient(b,c);d[a]=function(b){var c;return"function"==typeof e&&(e=e(b),c=function(){return e},c.hashCode=d[a].hashCode,d[a]=c),e}}return d[a]},a.prototype.provide_root=function(a,b,c,d){return this.roots[d]||(this.roots[d]={}),_.bind(function(e){return this.roots[d][a]||(this.roots[d][a]=this.provide_transient(b,c)(e)),this.roots[d][a]},this)},a.prototype.provide_provider=function(a,c){return function(d){var e=b.call(this,a,d);return c.apply(this,e)}},function(){var b={};a.prototype.build_provider=function(a,c,d,e){var f;if(!c.lifetime)return this.provide_provider(d,c.type);switch(c.lifetime){case"singleton":b[a]&&b[a].hashCode!==c.hashCode&&delete b[a],f=this.provide_singleton(a,c.type,d,b),f.hashCode=b[a].hashCode=c.hashCode,c.provider||(this.cache[c.name]=f);break;case"state":f=this.provide_singleton(a,c.type,d,this.state),f.hashCode=c.hashCode,c.provider||(this.cache[c.name]=f);break;case"root":f=this.provide_root(a,c.type,d,e);break;default:f=this.provide_transient(c.type,d)}return f}}(),a.prototype.currentHashCode=1,a.prototype.registerType=function(a,b,d,e){d=d||this.DEFAULT_LIFETIME,c(d),this._register("types",a,b,d),e&&(this.types[a].provider=e)},a.prototype.registerProvider=function(a,b){this._register("providers",a,b)},a.prototype.registerMain=function(a){this._register("providers","main",a)},a.prototype.registerFake=function(a,b,d){d=d||this.DEFAULT_LIFETIME,c(d),this._register("fakes",a,b,d)},a.prototype._register=function(a,b,c,d){var e,f,h;if("undefined"==typeof(h=this[a]))throw'invalid destination "'+a+'" provided. Valid destinations are types, providers, fakes and main';if("string"!=typeof b||""===b)throw"Type must have a name";if(!c)throw"no type was passed";if("function"==typeof c)f=c.$inject||g(c),e=c;else{if(!Array.isArray(c))throw"type must be a function or an array";if(e=c[c.length-1],c.$inject||e.$inject)throw"passed type cannot have both array notation and the $inject property populated";f=c.slice(0,c.length-1)}if("function"!=typeof e)throw"no type was passed";var i={name:b,type:e,dependencies:f,hashCode:this.currentHashCode++};d&&(i.lifetime=d),h[b]=i},a.prototype.harness=function(a){var b=this;return function(c){return b.inject(a)(c)}},a.prototype.removeFake=function(a){delete this.fakes[a]},a.prototype.flushFakes=function(){this.fakes={}};var g=function(){var a=/^function ?\w* ?\(((?:\w+|(?:, ?))+)\)/,b=/, ?/;return function(c){var d,e=c.toString();return(d=a.exec(e))?d[1].split(b):null}}();a.prototype.getType=function(a){var b=this.fakes[a]||this.types[a];return b?b.type:null},a.prototype.extend=function(a,b){var c=this.types[a];if(!c)throw'No type "'+a+'" found.';b.prototype=this.get(a)},a.prototype.noConflict=function(){window.injector=e},a.prototype.clearState=function(){this.state={};var a=this;_.each(this.types,_.bind(function(b,c){"state"===b.lifetime&&Object.keys(this.cache).forEach(function(b){~b.indexOf(c)&&delete a.cache[b]})},this))};var h=function(){};return window.angular&&angular.module&&angular.module("injectJS",[]).service("$injectJS",[a]).run(["$rootScope","$injectJS",function(a,b){a.$on("$locationChangeStart",function(){b.clearState()})}]),h=function(){injector.clearState()},window.addEventListener("hashchange",h),a.prototype.removeDefaultListener=function(){window.removeEventListener("hashchange",h)},new a}();