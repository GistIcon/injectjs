/*! inject-js - vv0.3.4 - 2016-03-30
* https://github.com/nstraub/injectjs
* Copyright (c) 2016 ; Licensed  */
"use strict";var injector=function(){function a(){this.types={},this.providers={},this.fakes={},this.state={}}function b(a,c,d){var e,f,g;if(e=a.parent){if(f=a.descriptor.name,g=e.descriptor.name,d.unshift(f),e.descriptor.provider!==f&&~c.indexOf(g))throw"Circular Reference Detected: "+g+" -> "+d.join(" -> ")+" -> "+g;b(e,c,d)}}function c(a,b,c){var d=this,e={};return _.each(b,function(a,b){e[b]=function(){return a}}),_.assign(a,e),_.map(a,function(a,e){if(!a)throw'There is no dependency named "'+e+'" registered.';return a.call(d,b,c)})}function d(a){if(!~e.indexOf(a))throw'invalid lifetime "'+a+'" provided. Valid lifetimes are singleton, transient, instance and parent'}a.prototype.DEFAULT_LIFETIME="transient",a.prototype.cache={},a.prototype.roots={},a.prototype.currentHashCode=1;var e=["singleton","transient","root","parent","state"],f=window.injector;a.prototype._build_anonymous_descriptor=function(a){return"function"==typeof a?{type:a,dependencies:h(a)}:{type:a[a.length-1],dependencies:a.slice(0,a.length-1)}},a.prototype._inject=function(a,c,d,e){var f,g,h,i=this;if(!c){if(d)return null;throw'There is no dependency named "'+a+'" registered.'}if(a=c.name,g={},g.hashCode=++this.currentHashCode,g.descriptor=c,g.parent=d||null,g.root=e||g,this.cache[a]&&this.cache[a].hashCode===c.hashCode)return function(b,c){return i.cache[a](b,c||g)};if(e&&c.dependencies&&b(g,c.dependencies,[]),e=g.root,h=c.provider,h&&(!d||h!==d.descriptor.name))return this._inject(h,this._get_descriptor(h),g,e);f={};var j=0;return _.each(c.dependencies,_.bind(function(a){var b=this._inject(a,this._get_descriptor(a),g,e);f[a]?f[a+j++]=b:f[a]=b},this)),g.providers=f,this._build_provider(g)},a.prototype._get_descriptor=function(a){return"string"==typeof a?this.fakes[a]||this.types[a]||this.providers[a]:this._build_anonymous_descriptor(a)},a.prototype.inject=function(a){return this._inject(a,this._get_descriptor(a))},a.prototype.get=function(a,b,c){var d=this.inject(a);return b?d.call(b,c):d(c)},a.prototype.run=function(a,b){if(!this.providers.main)throw"No main method registered. Please register one by running injector.registerMain() before running the app";return this.get("main",a,b)};var g=Object.create;a.prototype._provide_transient=function(a){var b=a.descriptor.type,d=a.providers;return function(a,e){var f=g(b.prototype);return b.apply(f,c.call(this,d,a,e)),f}},a.prototype._provide_cached=function(a,b){var c=a.descriptor.name;if(!b[c]){var d=this._provide_transient(a);b[c]=function(a){var e;return"function"==typeof d&&(d=d(a),e=function(){return d},e.hashCode=b[c].hashCode,b[c]=e),d}}return b[c]},a.prototype._provide_root=function(a){var b=a.descriptor.name,c=a.root.roots=a.root.roots||{},d=this;return function(e,f){return f&&(c=f.root.roots=f.root.roots||{}),c[b]||(c[b]=d._provide_transient(a)(e,f)),c[b]}},a.prototype._provide_provider=function(a){return function(b,d){var e=c.call(this,a.providers,b,d);return a.descriptor.type.apply(this,e)}},a.prototype._provide_parent=function(a){var b=this;return function(c,d){d=d||a;for(var e=d,f=e;e=e.parent;){if(e.children&&e.children[d.descriptor.name]){f=e;break}e.descriptor.dependencies&&~e.descriptor.dependencies.indexOf(d.descriptor.name)&&(f=e)}e=f,e.children=e.children||{};var g=a.descriptor.name;return e.children[g]&&"building"!==e.children[g]||(e.children[g]="building",e.children[g]=b._provide_transient(a)(c,a)),e.children[g]}},function(){var b={};jasmine&&jasmine.getEnv&&jasmine.getEnv().addReporter({specStarted:function(){b={}}}),a.prototype._build_provider=function(a){var c,d,e=a.descriptor,f=e.name,g=null;if(e.lifetime)switch(e.lifetime){case"singleton":d="provide_cached",g=b;break;case"state":d="provide_cached",g=this.state;break;default:d="provide_"+e.lifetime}else d="provide_provider";return c=this["_"+d](a,g),f&&!e.provider&&(c.hashCode=e.hashCode,this.cache[e.name]=c),c}}(),a.prototype.registerType=function(a,b,c,e){if(c=c||this.DEFAULT_LIFETIME,d(c),"singleton"===c&&this.cache[a])throw"you cannot re-register a singleton that has already been instantiated";this._register("types",a,b,c),e&&(this.types[a].provider=e)},a.prototype.registerProvider=function(a,b){this._register("providers",a,b)},a.prototype.registerMain=function(a){this._register("providers","main",a)},a.prototype.registerFake=function(a,b,c){c=c||this.DEFAULT_LIFETIME,d(c),this._register("fakes",a,b,c)},a.prototype._register=function(a,b,c,d){var e,f,g;if("types"!==a&&"providers"!==a&&"fakes"!==a)throw'invalid destination "'+a+'" provided. Valid destinations are types, providers and fakes';if(g=this[a],"string"!=typeof b||""===b)throw"Type must have a name";if(!c)throw"no type was passed";if("function"==typeof c)f=c.$inject||h(c),e=c;else{if(!Array.isArray(c))throw"type must be a function or an array";if(e=c[c.length-1],c.$inject||e.$inject)throw"passed type cannot have both array notation and the $inject property populated";f=c.slice(0,c.length-1)}if("function"!=typeof e)throw"no type was passed";g[b]={name:b,type:e,dependencies:f,lifetime:d,hashCode:this.currentHashCode++}},a.prototype.harness=function(a){var b=this;return function(c){return b.inject(a)(c)}},a.prototype.removeFake=function(a){delete this.fakes[a]},a.prototype.flushFakes=function(){this.fakes={}};var h=function(){var a=/^function ?\w* ?\(((?:\w+|(?:, ?))+)\)/,b=/, ?/;return function(c){var d,e=c.toString();return(d=a.exec(e))?d[1].split(b):null}}();a.prototype.getType=function(a){var b=this.fakes[a]||this.types[a];return b?b.type:null},a.prototype.extend=function(a,b){var c=this.types[a];if(!c)throw'No type "'+a+'" found.';if("transient"!==c.lifetime)throw"Only transient lifetime types are allowed for now";b.prototype=this.get(a)},a.prototype.noConflict=function(){window.injector=f},a.prototype.clearState=function(){this.state={};var a=this;_.each(this.types,function(b,c){"state"===b.lifetime&&Object.keys(a.cache).forEach(function(b){~b.indexOf(c)&&delete a.cache[b]})})},window.angular&&angular.module&&angular.module("injectJS",[]).service("$injectJS",[a]).run(["$rootScope","$injectJS",function(a,b){a.$on("$locationChangeStart",function(){b.clearState()}),b.removeDefaultListener()}]);var i=function(){injector.clearState()};return window.addEventListener("hashchange",i),a.prototype.removeDefaultListener=function(){window.removeEventListener("hashchange",i)},new a}();