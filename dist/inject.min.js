/*! inject-js - v0.4.15 - 2016-04-26
* https://github.com/nstraub/injectjs
* Copyright (c) 2016 ; Licensed  */
"use strict";var injector=function(a){function b(){this.types={},this.providers={},this.fakes={},this.state={}}function c(b,d,e){var f,g,h;if(f=b.parent){g=b.descriptor.name||b.descriptor.type,h=f.descriptor.name,e.unshift(g);var i=f.descriptor.provider;if(a.isArray(i)&&(i=i[i.length-1]),i!==g&&~d.indexOf(h))throw"Circular Reference Detected: "+h+" -> "+e.join(" -> ")+" -> "+h;c(f,d,e)}}function d(b,c){b.root=c,a.each(b.dependencies,function(a){d(a,c)})}function e(b,c,d){var e=this;return b=b||{},a.map(c.providers,function(a,f){if(a)return a.call(e,b,c.dependencies[f]);if(b.hasOwnProperty(f))return b[f];if(d.strict_dependency_providers)throw'There is no dependency named "'+f+'" registered.';return null})}function f(a){if(!~g.indexOf(a))throw'invalid lifetime "'+a+'" provided. Valid lifetimes are singleton, transient, instance and parent'}b.prototype.DEFAULT_LIFETIME="transient",b.prototype.cache={},b.prototype.roots={},b.prototype.currentHashCode=1,b.prototype.strict_dependency_providers=!0;var g=["singleton","transient","root","parent","state"],h=window.injector;b.prototype._build_anonymous_descriptor=function(a){return"function"==typeof a?{type:a,dependencies:j(a)}:{type:a[a.length-1],dependencies:a.slice(0,a.length-1)}},b.prototype._build_graph=function(b,d,e,f){var g,h,i={};if("string"==typeof b&&~b.indexOf("::provider")&&(b=b.replace("::provider",""),d=this._get_descriptor(b),i.return_provider=!0),!d){if(e)return null;throw'There is no dependency named "'+b+'" registered.'}if(i.hashCode=++this.currentHashCode,i.descriptor=d,i.parent=e||null,i.root=f||i,f&&d.dependencies&&c(i,d.dependencies,[]),g=d.provider,g&&(a.isArray(g)&&(g=g[g.length-1]),!e||g!==e.descriptor["string"==typeof g?"name":"type"])){var j=this._get_descriptor(d.provider);return j.dependencies.shift(),j.dependencies.unshift(b),this._build_graph(g,j,e,i.root)}h={};var k=0;return a.each(d.dependencies,a.bind(function(a){var b=this._build_graph(a,this._get_descriptor(a),i,i.root);h[a]?h[a+k++]=b:h[a]=b},this)),i.dependencies=h,i},b.prototype._provider_getter=function(b,c){var e=this;return function(f,g){var h=b();return c.return_provider?function(b){var f=a.cloneDeepWith(c,function(a,b){switch(b){case"root":return a;case"children":return{};case"hashCode":return++e.currentHashCode;default:return}});return f.parent=c.parent,c===c.root&&(d(f,f),f.roots&&delete f.roots),h.call(this,f,b)}:h.call(this,g||c,f)}},b.prototype._inject=function(b){if(null===b)return null;var c,d=b.descriptor,e=d.name;if(c={},a.each(b.dependencies,a.bind(function(a,b){c[b]=this._inject(a)},this)),b.providers=c,this.cache[e]&&this.cache[e].hashCode===d.hashCode)return this._provider_getter(a.bind(function(){return this.cache[e]||this.inject(b)},this),b);var f=this._build_provider(b.descriptor);return this._provider_getter(a.bind(function(){return f.hashCode===this._get_descriptor(e).hashCode?f:this.inject(b)},this),b)},b.prototype._get_descriptor=function(a){return"string"==typeof a?this.fakes[a]||this.types[a]||this.providers[a]:"undefined"==typeof a?{}:this._build_anonymous_descriptor(a)},b.prototype.inject=function(a){return this._inject(this._build_graph(a,this._get_descriptor(a)))},b.prototype.get=function(a,b,c){var d=this.inject(a);return d.call(c,b)},b.prototype.run=function(a,b){if(!this.providers.main)throw"No main method registered. Please register one by running injector.registerMain() before running the app";return this.get("main",a,b)};var i=Object.create;b.prototype._provide_transient=function(a){var b=a.type,c=this;return function(a,d){var f=i(b.prototype);return b.apply(f,e.call(this,d,a,c)),f}},b.prototype._provide_cached=function(a,b){var c=a.name;if(!b[c]){var d=this._provide_transient(a);b[c]=function(a,e){var f;return"function"==typeof d&&(d=d.call(this,a,e),f=function(){return d},f.hashCode=b[c].hashCode,b[c]=f),d}}return b[c]},b.prototype._provide_root=function(a){var b=a.name,c=this;return function(d,e){var f=d.root.roots=d.root.roots||{};return f[b]||(f[b]=c._provide_transient(a).call(this,d,e)),f[b]}},b.prototype._provide_provider=function(a){var b=this;return function(c,d){var f=e.call(this,d,c,b);return a.type.apply(this,f)}},b.prototype._provide_parent=function(a){var b=this;return function(c,d){for(var e=c,f=e,g=a.name;e=e.parent;){if(e.children&&e.children[g]){f=e;break}e.descriptor.dependencies&&~e.descriptor.dependencies.indexOf(g)&&(f=e)}return e=f,e.children=e.children||{},e.children[g]&&"building"!==e.children[g]||(e.children[g]="building",e.children[g]=b._provide_transient(a).call(this,c,d)),e.children[g]}},function(){var a={};window.jasmine&&jasmine.getEnv&&jasmine.getEnv().addReporter({specStarted:function(){a={}}}),b.prototype._build_provider=function(b){var c,d,e=b.name,f=null;if(b.lifetime)switch(b.lifetime){case"singleton":d="provide_cached",f=a;break;case"state":d="provide_cached",f=this.state;break;default:d="provide_"+b.lifetime}else d="provide_provider";return c=this["_"+d](b,f),c.hashCode=b.hashCode,e&&!b.provider&&(this.cache[e]=c),c}}(),b.prototype.registerType=function(a,b,c,d){if(c=c||this.DEFAULT_LIFETIME,f(c),"singleton"===c&&this.cache[a])throw"you cannot re-register a singleton that has already been instantiated";this._register("types",a,b,c),d&&(this.types[a].provider=d)},b.prototype.registerProvider=function(a,b){this._register("providers",a,b)},b.prototype.registerMain=function(a){this._register("providers","main",a)},b.prototype.registerFake=function(a,b,c,d){c=c||this.DEFAULT_LIFETIME,f(c),this._register("fakes",a,b,c),d&&(this.fakes[a].provider=d)},b.prototype._register=function(a,b,c,d){var e,f,g;if("types"!==a&&"providers"!==a&&"fakes"!==a)throw'invalid destination "'+a+'" provided. Valid destinations are types, providers and fakes';if(g=this[a],"string"!=typeof b||""===b)throw"Type must have a name";if(!c)throw"no type was passed";if("function"==typeof c)f=c.$inject||c.prototype.$inject||j(c),e=c;else{if(!Array.isArray(c))throw"type must be a function or an array";if(e=c[c.length-1],c.$inject||e.$inject)throw"passed type cannot have both array notation and the $inject property populated";f=c.slice(0,c.length-1)}if("function"!=typeof e)throw"no type was passed";this.cache[b]&&delete this.cache[b],g[b]={name:b,type:e,dependencies:f,lifetime:d,hashCode:this.currentHashCode++}},b.prototype.harness=function(a){var b=this;return function(c){return b.inject(a)(c)}},b.prototype.removeFake=function(a){delete this.fakes[a]},b.prototype.flushFakes=function(){this.fakes={}};var j=function(){var a=/^function ?\w* ?\(((?:\w+|(?:, ?))+)\)/,b=/, ?/;return function(c){var d,e=c.toString();return(d=a.exec(e))?d[1].split(b):null}}();b.prototype.getType=function(a){var b=this.fakes[a]||this.types[a];return b?b.type:null},b.prototype.extend=function(a,b){var c=this.types[a];if(!c)throw'No type "'+a+'" found.';if("transient"!==c.lifetime)throw"Only transient lifetime types are allowed for now";b.prototype=this.get(a)},b.prototype.noConflict=function(){window.injector=h},b.prototype.clearState=function(){var b=this;a.each(this.state,function(a,c){b.cache[c]&&delete b.cache[c]}),this.state={}};var k=new b;window.angular&&angular.module&&angular.module("injectJS",[]).factory("$injectJS",[function(){return k}]).run(["$rootScope","$injectJS",function(a,b){a.$on("$locationChangeStart",function(){b.clearState()}),b.removeDefaultListener()}]);var l=function(){k.clearState()};return window.addEventListener("hashchange",l),b.prototype.removeDefaultListener=function(){window.removeEventListener("hashchange",l)},k}(_);