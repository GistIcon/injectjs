/*! injectjs - v1.0.0 - 2016-03-11
* https://github.com/nstraub/injectjs
* Copyright (c) 2016 ; Licensed  */
"use strict";var injector=function(){function a(){this.types={},this.providers={},this.fakes={},this.state={}}function b(a,c){var d,e;if("string"==typeof a){if(d=this.fakes[a]||this.types[a]||this.providers[a],this.cache[a]&&this.cache[a].hashCode===d.hashCode)return this.cache[a]}else d=this.build_anonymous_descriptor(a);if(!d){if(c)return null;throw'There is no dependency named "'+a+'" registered.'}return d.provider&&d.provider!==c?b.call(this,d.provider,a):(e={},_.each(d.dependencies,function(c){e[c]=b.call(this,c,a)},this),this.build_provider(a,d,e))}function c(a,b){var c=this,d={};return _.each(b,function(a,b){d[b]=function(){return a}}),_.assign(a,d),_.map(a,function(a,b){if(!a)throw'There is no dependency named "'+b+'" registered.';return a.call(c)})}function d(){injector.clearState()}var e=["singleton","transient","root","parent","state"],f=window.injector;a.prototype.inject=function(a){return b.call(this,a)},a.prototype.get=function(a,b,c){var d=this.inject(a);return b?d.call(b,c):d(c)},a.prototype.run=function(a,b){if(!this.providers.main)throw"No main method registered. Please register one by running injector.registerMain() before running the app";return this.get("main",a,b)},a.prototype.cache={};var g=Object.create;a.prototype.provide_transient=function(a,b){return function(d){var e=g(a.prototype);return a.apply(e,c(b,d)),e}},a.prototype.provide_singleton=function(a,b,c,d){var e=this;if(!d[a]){var f=this.provide_transient(b,c);d[a]=function(b){return"function"==typeof f&&(f=f(b),e.cache[a]=d[a]=function(){return f}),f}}return d[a]},a.prototype.provide_provider=function(a,b){return function(d){var e=c.call(this,a,d);return b.apply(this,e)}},function(){var b={};a.prototype.build_provider=function(a,c,d){if(!c.lifetime)return this.cache[a]=this.provide_provider(d,c.type);switch(c.lifetime){case"singleton":return this.cache[a]=this.provide_singleton(a,c.type,d,b);case"state":return this.cache[a]=this.provide_singleton(a,c.type,d,this.state);default:return this.cache[a]=this.provide_transient(c.type,d)}}}();var h=function(){var a=/^function ?\w* ?\(((?:\w+|(?:, ?))+)\)/,b=/, ?/;return function(c){var d,e=c.toString();return(d=a.exec(e))?d[1].split(b):null}}();return a.prototype.registerType=function(a,b,c,d){if(c=c||"transient",!~e.indexOf(c))throw'invalid lifetime "'+c+'" provided. Valid lifetimes are singleton, transient, instance and parent';this._register("types",a,b,c),d&&(this.types[a].provider=d)},a.prototype.registerProvider=function(a,b){this._register("providers",a,b)},a.prototype.registerMain=function(a){this._register("providers","main",a)},a.prototype.registerFake=function(a,b,c){if(c=c||"transient",!~e.indexOf(c))throw'invalid lifetime "'+c+'" provided. Valid lifetimes are singleton, transient, instance and parent';this._register("fakes",a,b,c)},a.prototype._register=function(a,b,c,d){var e,f,g=this[a];if("undefined"==typeof g)throw'invalid destination "'+a+'" provided. Valid destinations are types, providers, fakes and main';if("string"!=typeof b||""===b)throw"Type must have a name";if(!c)throw"no type was passed";if("function"==typeof c?(f=h(c),e=c):(e=c.pop(),f=c),"function"!=typeof e)throw"no type was passed";var i={name:b,type:e,dependencies:f,hashCode:this.currentHashCode++};d&&(i.lifetime=d),g[b]=i},a.prototype.build_anonymous_descriptor=function(a){return"function"==typeof a?{type:a,dependencies:h(a)}:{type:a.pop(),dependencies:a}},a.prototype.harness=function(a){var b=this;return function(c){return b.inject(a)(c)}},a.prototype.removeFake=function(a){delete this.fakes[a]},a.prototype.flushFakes=function(){this.fakes={}},a.prototype.getType=function(a){var b=this.fakes[a]||this.types[a];return b?b.type:null},a.prototype.extend=function(a,b){var c=this.types[a];if(!c)throw'No type "'+a+'" found.';b.prototype=this.get(a)},a.prototype.noConflict=function(){window.injector=f},a.prototype.removeDefaultListener=function(){window.removeEventListener("hashchange",d)},a.prototype.clearState=function(){this.state={},_.each(this.types,function(a,b){"state"===a.lifetime&&delete this.cache[b]},this)},window.addEventListener("hashchange",d),new a}();